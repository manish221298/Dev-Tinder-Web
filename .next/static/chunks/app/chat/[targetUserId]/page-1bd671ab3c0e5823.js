(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{7530:(e,t,s)=>{Promise.resolve().then(s.bind(s,8579))},8579:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(5155),l=s(2115),o=s(8675),n=s(9829);let a=()=>{let e=window.location.origin;return(0,n.io)(e)};var i=s(1213),c=s(5125),d=s(1496);let u=e=>{let{targetUserId:t}=e,s=(0,i.d4)(e=>e.user),o=null==s?void 0:s._id,[n,u]=(0,l.useState)(""),[h,x]=(0,l.useState)([]),m=(0,l.useRef)(null),g=async()=>{try{let e=await c.A.get("".concat(d.pc,"/chat/").concat(t),{headers:{Authorization:"Bearer ".concat((0,d.gf)())}});x(null==e?void 0:e.data)}catch(e){console.log(e)}};(0,l.useEffect)(()=>{g()},[t]),(0,l.useEffect)(()=>{(()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})})()},[h]),(0,l.useEffect)(()=>{if(!o)return;let e=a();return e.emit("joinChat",{userId:o,targetUserId:t}),e.on("messageReceived",e=>{let{firstName:t,text:s}=e;x(e=>[...e,{firstName:t,text:s}])}),()=>{e.disconnect()}},[o,t]);let f=()=>{n.trim()&&(a().emit("sendMessage",{firstName:s.firstName,userId:o,targetUserId:t,text:n}),u(""))};return console.log("message 1",h),console.log("message 2",n),(0,r.jsx)("div",{className:"flex justify-center items-center min-h-[70vh] px-4 py-6",children:(0,r.jsx)("div",{className:"bg-white/90 backdrop-blur-md shadow-2xl w-full max-w-4xl border border-gray-200 rounded-lg",children:(0,r.jsxs)("div",{className:"p-0",children:[(0,r.jsx)("div",{className:"bg-blue-600 p-4 rounded-t-lg",children:(0,r.jsxs)("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Chat Room"]})}),(0,r.jsx)("div",{className:"h-[50vh] sm:h-[60vh] overflow-y-auto space-y-4 p-4 bg-gray-50",children:(null==h?void 0:h.length)===0?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,r.jsx)("p",{className:"text-lg",children:"No messages yet. Start the conversation!"})]}):(0,r.jsxs)(r.Fragment,{children:[null==h?void 0:h.map((e,t)=>{let l=(null==e?void 0:e.firstName)===(null==s?void 0:s.firstName);return(0,r.jsx)("div",{className:"flex ".concat(l?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md ".concat(l?"order-2":"order-1"),children:[(0,r.jsxs)("div",{className:"text-xs opacity-70 mb-1",children:[null==e?void 0:e.firstName,(0,r.jsx)("time",{className:"text-xs opacity-50 ml-2",children:(e=>{if(!e)return"Just now";let t=new Date(e),s=Math.floor((new Date-t)/6e4);if(s<1)return"Just now";if(s<60)return"".concat(s," mins ago");let r=Math.floor(s/60);if(r<24)return"".concat(r," hours ago");let l=Math.floor(r/24);return l<7?"".concat(l," days ago"):t.toLocaleDateString()})(e.createdAt)})]}),(0,r.jsx)("div",{className:"rounded-lg px-4 py-2 ".concat(l?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:null==e?void 0:e.text}),(0,r.jsx)("div",{className:"text-xs opacity-50 mt-1",children:l&&"Seen"})]})},t)}),(0,r.jsx)("div",{ref:m})]})}),(0,r.jsxs)("div",{className:"flex gap-2 items-center p-4 bg-white border-t border-gray-200 rounded-b-lg",children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())},placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,r.jsx)("button",{onClick:f,disabled:!n.trim(),className:"w-12 h-12 rounded-full bg-blue-600 text-white hover:bg-blue-700 hover:scale-110 transition-transform disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})})})};function h(e){let{params:t}=e,{targetUserId:s}=(0,l.use)(t);return(0,r.jsx)(o.A,{children:(0,r.jsx)(u,{targetUserId:s})})}}},e=>{e.O(0,[555,690,829,675,441,493,358],()=>e(e.s=7530)),_N_E=e.O()}]);